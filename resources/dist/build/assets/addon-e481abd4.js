function h(e,t,s,c,i,n,r,d){var o=typeof e=="function"?e.options:e;t&&(o.render=t,o.staticRenderFns=s,o._compiled=!0),c&&(o.functional=!0),n&&(o._scopeId="data-v-"+n);var l;if(r?(l=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),i&&i.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(r)},o._ssrRegister=l):i&&(l=d?function(){i.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(o.functional){o._injectStyles=l;var f=o.render;o.render=function(m,u){return l.call(u),f(m,u)}}else{var _=o.beforeCreate;o.beforeCreate=_?[].concat(_,l):[l]}return{exports:e,options:o}}const p={mixins:[Listing],props:["initialColumns"],data(){return{columns:this.initialColumns,requestUrl:cp_url("statamic-locks/locks")}}};var k=function(){var t=this,s=t._self._c;return s("data-list",{attrs:{"visible-columns":t.columns,columns:t.columns,rows:t.items},scopedSlots:t._u([{key:"default",fn:function({filteredRows:c}){return s("div",{staticClass:"card overflow-hidden p-0 relative"},[s("data-list-table",{scopedSlots:t._u([{key:"cell-title",fn:function({row:i}){return[s("a",{attrs:{href:i.show_url}},[t._v(t._s(i.title))])]}},{key:"actions",fn:function({row:i,index:n}){return[i.can_delete?s("dropdown-list",[s("dropdown-item",{staticClass:"warning",attrs:{text:t.__("Delete")},on:{click:function(r){t.$refs[`deleter_${i.id}`].confirm()}}},[s("resource-deleter",{ref:`deleter_${i.id}`,attrs:{resource:i},on:{deleted:t.request}})],1)],1):t._e()]}}],null,!0)})],1)}}])})},v=[],b=h(p,k,v,!1,null,null,null,null);const w=b.exports,g={props:{itemId:{type:String,required:!0},itemType:{type:String,required:!0}},data(){return{show:!1,status:[]}},mounted(){this.checkLockStatus(),setInterval(()=>{this.checkLockStatus()},1e3*Statamic.$config.get("statamicLocks.pollInterval",30)),window.addEventListener("beforeunload",()=>{this.show||this.$axios.delete(cp_url("statamic-locks/locks/"+this.status.lock_id+"?delay=true")).then(e=>{}).catch(e=>this.handleAxiosError(e))})},methods:{back(){window.history.back()},deleteLock(){this.status.lock_id||this.$toast.error(__("This isnt possible")),this.$axios.delete(cp_url("statamic-locks/locks/"+this.status.lock_id)).then(e=>{window.location.reload()}).catch(e=>this.handleAxiosError(e))},checkLockStatus(){this.$axios.post(cp_url("statamic-locks/locks"),{item_id:this.itemId,item_type:this.itemType}).then(e=>{if(e.data.error){this.show=!0,this.status=e.data;return}this.show=!1,this.status=e.data}).catch(e=>this.handleAxiosError(e))},handleAxiosError(e){this.$toast.error(__("Error getting lock status"))},locks(){window.location.href=cp_url("statamic-locks/locks")}}};var C=function(){var t=this,s=t._self._c;return s("div",[t.show?s("modal",{staticClass:"modal-lock"},[s("div",{staticClass:"flex items-center p-6 bg-gray-200 border-b text-center"},[t._v(" "+t._s(t.__("Item Locked"))+" ")]),s("div",{staticClass:"p-6"},[s("p",{staticClass:"text-base"},[t._v(t._s(t.__("Locked by :name, last updated :since",{name:t.status.locked_by.name,since:t.status.last_updated}))+" ")])]),s("div",{staticClass:"p-4 bg-gray-200 border-t flex items-center justify-between text-sm"},[s("button",{staticClass:"btn",domProps:{textContent:t._s(t.__("Back"))},on:{click:t.back}}),this.can("delete user locks")?s("button",{staticClass:"btn btn-danger",domProps:{textContent:t._s(t.__("Delete lock"))},on:{click:t.deleteLock}}):t._e(),this.can("view locks")?s("button",{staticClass:"btn btn-primary",domProps:{textContent:t._s(t.__("Show locks"))},on:{click:t.locks}}):t._e()])]):t._e()],1)},$=[],S=h(g,C,$,!1,null,null,null,null);const y=S.exports;Statamic.booting(()=>{Statamic.component("statamic-locks-listing",w),Statamic.component("statamic-locks-modal",y)});Statamic.booted(()=>{let e=("/"+Statamic.$config.get("urlPath")).split("/"),t=Statamic.$config.get("statamicLocks.locks")??{};for(let s in t){let c=t[s].split("/"),i=!0,n=0,r="",d="";for(;i&&c.length;){if(r=c.shift(),r=="{id}"){d=e[n];continue}if(!(r=="*"||e[n]==r)){i=!1;continue}n++,c.length&&e.length<n+1&&(i=!1)}i&&d&&!c.length&&Statamic.$components.append("statamic-locks-modal",{props:{itemType:s,itemId:d}})}});
